<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CanvasKit CDN çŠ¶æ€æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .cdn-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid #ccc;
      transition: all 0.3s;
    }

    .cdn-card.active {
      border-left-color: #28a745;
      background: #d4edda;
    }

    .cdn-card.testing {
      border-left-color: #ffc107;
      background: #fff3cd;
    }

    .cdn-card.failed {
      border-left-color: #dc3545;
      background: #f8d7da;
    }

    .cdn-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .cdn-name {
      font-weight: 600;
      font-size: 16px;
      color: #333;
    }

    .cdn-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-unknown {
      background: #e9ecef;
      color: #6c757d;
    }

    .status-testing {
      background: #fff3cd;
      color: #856404;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
    }

    .status-failed {
      background: #f8d7da;
      color: #721c24;
    }

    .cdn-url {
      font-size: 13px;
      color: #666;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      margin-bottom: 8px;
    }

    .cdn-details {
      display: flex;
      gap: 20px;
      font-size: 13px;
      color: #666;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 10px;
      margin-top: 20px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .current-config {
      background: #e7f3ff;
      border: 2px solid #0066cc;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .config-title {
      font-weight: 600;
      color: #0066cc;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .config-value {
      font-family: 'Courier New', monospace;
      color: #333;
      font-size: 14px;
      word-break: break-all;
    }

    .result-section {
      margin-top: 30px;
      padding-top: 30px;
      border-top: 2px solid #e9ecef;
    }

    .loading {
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” CanvasKit CDN çŠ¶æ€æ£€æµ‹</h1>
    <p class="subtitle">æ£€æµ‹å½“å‰ä½¿ç”¨çš„ CDN æºå’Œæ‰€æœ‰ CDN çš„å¯ç”¨æ€§</p>

    <div class="current-config" id="currentConfig">
      <div class="config-title">ğŸ“Œ å½“å‰é…ç½®</div>
      <div class="config-value" id="currentCdn">æ£€æµ‹ä¸­...</div>
    </div>

    <div id="cdnList">
      <!-- CDN å¡ç‰‡å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
    </div>

    <div>
      <button class="btn" onclick="testAllCDNs()">ğŸ”„ æµ‹è¯•æ‰€æœ‰ CDN</button>
      <button class="btn btn-secondary" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
    </div>

    <div class="result-section" id="resultSection" style="display: none;">
      <h3 style="margin-bottom: 15px; color: #333;">ğŸ“Š æµ‹è¯•ç»“æœ</h3>
      <div id="testResults"></div>
    </div>
  </div>

  <script>
    const CDN_SOURCES = [
      {
        name: 'Unpkg CDN',
        url: 'https://unpkg.com/canvaskit-wasm@0.40.0/bin/',
        index: 0,
        description: 'ä¼˜å…ˆé€‰æ‹©ï¼Œé€šå¸¸é€Ÿåº¦æœ€å¿«'
      },
      {
        name: 'jsDelivr CDN',
        url: 'https://cdn.jsdelivr.net/npm/canvaskit-wasm@0.40.0/bin/',
        index: 1,
        description: 'å¤‡ç”¨æ–¹æ¡ˆï¼Œå…¨çƒåŠ é€Ÿ'
      },
      {
        name: 'æœ¬åœ°æ–‡ä»¶',
        url: '/canvaskit/',
        index: 2,
        description: 'æœ€åä¿åº•ï¼Œæœ¬åœ°æœåŠ¡å™¨'
      }
    ];

    // åˆå§‹åŒ–é¡µé¢
    function init() {
      // æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ CDN
      const currentIndex = parseInt(localStorage.getItem('canvaskit_cdn_index') || '0');
      const currentCdn = CDN_SOURCES[currentIndex];
      document.getElementById('currentCdn').innerHTML = `
        <strong>${currentCdn.name}</strong><br>
        ${currentCdn.url}<br>
        <small style="color: #666; margin-top: 5px; display: block;">ç´¢å¼•: ${currentIndex} | ${currentCdn.description}</small>
      `;

      // æ¸²æŸ“ CDN å¡ç‰‡
      const cdnList = document.getElementById('cdnList');
      CDN_SOURCES.forEach(cdn => {
        const isActive = cdn.index === currentIndex;
        const card = document.createElement('div');
        card.className = `cdn-card ${isActive ? 'active' : ''}`;
        card.id = `cdn-${cdn.index}`;
        card.innerHTML = `
          <div class="cdn-header">
            <div class="cdn-name">${cdn.name} ${isActive ? 'âœ“ å½“å‰ä½¿ç”¨' : ''}</div>
            <span class="cdn-status status-unknown" id="status-${cdn.index}">æœªæµ‹è¯•</span>
          </div>
          <div class="cdn-url">${cdn.url}</div>
          <div class="cdn-details">
            <div class="detail-item">
              ğŸ“ ${cdn.description}
            </div>
          </div>
          <div class="cdn-details" id="details-${cdn.index}" style="margin-top: 10px; display: none;">
            <div class="detail-item">
              â±ï¸ <span id="time-${cdn.index}">-</span>
            </div>
            <div class="detail-item">
              ğŸ“¦ <span id="size-${cdn.index}">-</span>
            </div>
          </div>
        `;
        cdnList.appendChild(card);
      });
    }

    // æµ‹è¯•å•ä¸ª CDN
    async function testCDN(cdn) {
      const statusEl = document.getElementById(`status-${cdn.index}`);
      const cardEl = document.getElementById(`cdn-${cdn.index}`);
      const detailsEl = document.getElementById(`details-${cdn.index}`);
      const timeEl = document.getElementById(`time-${cdn.index}`);
      const sizeEl = document.getElementById(`size-${cdn.index}`);

      // è®¾ç½®æµ‹è¯•ä¸­çŠ¶æ€
      statusEl.textContent = 'æµ‹è¯•ä¸­...';
      statusEl.className = 'cdn-status status-testing';
      cardEl.classList.add('testing');

      const startTime = Date.now();

      try {
        const testUrl = cdn.url + 'canvaskit.js';
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);

        const response = await fetch(testUrl, {
          method: 'HEAD',
          signal: controller.signal,
          cache: 'no-cache',
          mode: 'cors'
        });

        clearTimeout(timeoutId);
        const loadTime = Date.now() - startTime;

        if (response.ok) {
          statusEl.textContent = 'âœ… å¯ç”¨';
          statusEl.className = 'cdn-status status-success';
          cardEl.classList.remove('testing');
          
          timeEl.textContent = `${loadTime}ms`;
          
          // å°è¯•è·å–æ–‡ä»¶å¤§å°
          const contentLength = response.headers.get('content-length');
          if (contentLength) {
            const sizeMB = (parseInt(contentLength) / 1024 / 1024).toFixed(2);
            sizeEl.textContent = `${sizeMB} MB`;
          } else {
            sizeEl.textContent = 'æœªçŸ¥';
          }
          
          detailsEl.style.display = 'flex';

          return { success: true, time: loadTime, cdn: cdn };
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        const loadTime = Date.now() - startTime;
        statusEl.textContent = 'âŒ ä¸å¯ç”¨';
        statusEl.className = 'cdn-status status-failed';
        cardEl.classList.remove('testing');
        cardEl.classList.add('failed');

        timeEl.textContent = `è¶…æ—¶ (${loadTime}ms)`;
        sizeEl.textContent = error.message;
        detailsEl.style.display = 'flex';

        return { success: false, time: loadTime, cdn: cdn, error: error.message };
      }
    }

    // æµ‹è¯•æ‰€æœ‰ CDN
    async function testAllCDNs() {
      document.getElementById('resultSection').style.display = 'none';
      
      const results = [];
      for (const cdn of CDN_SOURCES) {
        const result = await testCDN(cdn);
        results.push(result);
      }

      // æ˜¾ç¤ºç»“æœæ‘˜è¦
      const resultSection = document.getElementById('resultSection');
      const testResults = document.getElementById('testResults');
      
      const successCount = results.filter(r => r.success).length;
      const fastestCDN = results.filter(r => r.success).sort((a, b) => a.time - b.time)[0];

      testResults.innerHTML = `
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
          <p style="margin-bottom: 10px;">
            âœ… å¯ç”¨ CDN: <strong>${successCount}/${CDN_SOURCES.length}</strong>
          </p>
          ${fastestCDN ? `
            <p style="margin-bottom: 10px;">
              âš¡ æœ€å¿« CDN: <strong>${fastestCDN.cdn.name}</strong> (${fastestCDN.time}ms)
            </p>
          ` : ''}
          <p style="margin-top: 15px; font-size: 13px; color: #666;">
            ğŸ’¡ å»ºè®®: ${
              fastestCDN 
                ? `ä½¿ç”¨ ${fastestCDN.cdn.name} ä»¥è·å¾—æœ€ä½³æ€§èƒ½`
                : 'æ‰€æœ‰ CDN éƒ½ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨æœ¬åœ°æ–‡ä»¶'
            }
          </p>
        </div>
      `;

      resultSection.style.display = 'block';
    }

    // æ¸…é™¤ç¼“å­˜
    function clearCache() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤ CanvasKit CDN ç¼“å­˜å—ï¼Ÿ\nä¸‹æ¬¡è®¿é—®å°†é‡æ–°é€‰æ‹© CDNã€‚')) {
        localStorage.removeItem('canvaskit_cdn_index');
        alert('âœ… ç¼“å­˜å·²æ¸…é™¤ï¼\nåˆ·æ–°é¡µé¢å°†ä½¿ç”¨é»˜è®¤ CDN (unpkg)ã€‚');
        location.reload();
      }
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', init);
  </script>
</body>
</html>

