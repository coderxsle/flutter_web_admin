<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="example">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>example</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- é¢„åŠ è½½å­—ä½“ - æé«˜å­—ä½“åŠ è½½ä¼˜å…ˆçº§ -->
  <link rel="preload" href="assets/fonts/NotoSansSC-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin>
  
  <style>
    /* å®šä¹‰å­—ä½“ - ä½¿ç”¨ font-display: swap é˜²æ­¢æ–‡å­—é—ªçƒ */
    @font-face {
      font-family: 'Noto Sans SC';
      src: url('assets/fonts/NotoSansSC-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap; /* å…ˆæ˜¾ç¤ºç³»ç»Ÿå­—ä½“ï¼Œå­—ä½“åŠ è½½å®Œåå†åˆ‡æ¢ */
    }
    
    @font-face {
      font-family: 'Roboto';
      src: url('assets/fonts/Roboto-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    
    @font-face {
      font-family: 'Roboto';
      src: url('assets/fonts/Roboto-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #loading-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
      transition: opacity 0.8s ease-out;
    }

    #loading-container.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    /* ç²’å­èƒŒæ™¯ */
    #particles-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* ä¸»åŠ è½½å™¨å®¹å™¨ */
    .loader-wrapper {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    /* 3Dæ—‹è½¬ç¯ */
    .rings-container {
      position: relative;
      width: 200px;
      height: 200px;
      perspective: 1000px;
    }

    .ring {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-style: preserve-3d;
      border-radius: 50%;
      border: 3px solid transparent;
      animation: rotate3d 3s infinite linear;
    }

    /* å¤–ç¯ */
    .ring-1 {
      width: 200px;
      height: 200px;
      margin: -100px 0 0 -100px;
      border-color: rgba(99, 102, 241, 0.8);
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.6), inset 0 0 30px rgba(99, 102, 241, 0.3);
      animation-duration: 6s;
    }

    /* ä¸­ç¯ */
    .ring-2 {
      width: 160px;
      height: 160px;
      margin: -80px 0 0 -80px;
      border-color: rgba(139, 92, 246, 0.8);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.6), inset 0 0 30px rgba(139, 92, 246, 0.3);
      animation-duration: 5s;
      animation-direction: reverse;
    }

    /* å†…ç¯ */
    .ring-3 {
      width: 120px;
      height: 120px;
      margin: -60px 0 0 -60px;
      border-color: rgba(236, 72, 153, 0.8);
      box-shadow: 0 0 30px rgba(236, 72, 153, 0.6), inset 0 0 30px rgba(236, 72, 153, 0.3);
      animation-duration: 2s;
    }

    /* ä¸­å¿ƒå‘å…‰çƒ */
    .core {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 60px;
      height: 60px;
      margin: -30px 0 0 -30px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff 0%, rgba(99, 102, 241, 0.8) 50%, transparent 100%);
      box-shadow: 0 0 40px rgba(99, 102, 241, 1), 0 0 60px rgba(139, 92, 246, 0.8);
      animation: pulse 2s infinite ease-in-out;
    }

    @keyframes rotate3d {
      0% {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
      }
      100% {
        transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
    }

    /* è¿›åº¦æ¡ */
    .progress-container {
      width: 300px;
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
      border-radius: 10px;
      width: 0%;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.8);
      position: relative;
      overflow: hidden;
      transition: width 0.3s ease-out;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 200%; }
    }

    /* Logo æ ·å¼ */
    .logo-container {
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap:0px;
      animation: fadeInDown 0.8s ease-out;
    }

    .logo-image {
      height: 320px;
      object-fit: contain;
      filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.6));
      animation: logoFloat 3s ease-in-out infinite;
    }
    
    /* ä¸“é—¨é’ˆå¯¹ Flutter Logo çš„æ ·å¼ */
    .flutter-logo {
      height: 130px;
    }

    .app-title {
      color: #fff;
      font-size: 62px;
      font-weight: 600;
      text-align: center;
      letter-spacing: 1px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleGlow 2s infinite ease-in-out;
    }

    @keyframes logoFloat {
      0%, 100% {
        transform: translateY(0px) rotate(0deg);
      }
      50% {
        transform: translateY(-10px) rotate(5deg);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes titleGlow {
      0%, 100% {
        filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5));
      }
      50% {
        filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.8));
      }
    }

    /* åŠ è½½æ–‡æœ¬ */
    .loading-text {
      color: #fff;
      font-size: 24px;
      font-weight: 600;
      text-align: center;
      margin-top: -10px;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(99, 102, 241, 0.8);
      animation: textGlow 2s infinite ease-in-out;
    }

    .loading-subtext {
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      margin-top: 10px;
      letter-spacing: 1px;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 300px;
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
    }

    .progress-percent {
      font-weight: 700;
      color: #6366f1;
      font-size: 16px;
      text-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
    }

    .loading-stats {
      font-size: 14px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.5px;
    }

    @keyframes textGlow {
      0%, 100% {
        text-shadow: 0 0 20px rgba(99, 102, 241, 0.8), 0 0 30px rgba(139, 92, 246, 0.6);
      }
      50% {
        text-shadow: 0 0 30px rgba(99, 102, 241, 1), 0 0 40px rgba(139, 92, 246, 0.8), 0 0 50px rgba(236, 72, 153, 0.6);
      }
    }

    /* è£…é¥°æ€§å…‰çº¿ */
    .light-beam {
      position: absolute;
      width: 2px;
      height: 100px;
      background: linear-gradient(180deg, transparent, rgba(99, 102, 241, 0.8), transparent);
      animation: beam 3s infinite ease-in-out;
    }

    .light-beam:nth-child(1) {
      top: 10%;
      left: 20%;
      animation-delay: 0s;
    }

    .light-beam:nth-child(2) {
      top: 30%;
      right: 15%;
      animation-delay: 0.5s;
    }

    .light-beam:nth-child(3) {
      bottom: 20%;
      left: 30%;
      animation-delay: 1s;
    }

    .light-beam:nth-child(4) {
      bottom: 10%;
      right: 25%;
      animation-delay: 1.5s;
    }

    @keyframes beam {
      0%, 100% {
        opacity: 0;
        transform: translateY(0) scaleY(0.5);
      }
      50% {
        opacity: 1;
        transform: translateY(-20px) scaleY(1);
      }
    }
  </style>
</head>
<body>
  <!-- åŠ è½½åŠ¨ç”»å®¹å™¨ -->
  <div id="loading-container">
    <!-- ç²’å­èƒŒæ™¯ -->
    <canvas id="particles-canvas"></canvas>
    
    <!-- è£…é¥°å…‰æŸ -->
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    <div class="light-beam"></div>
    
    <!-- ä¸»åŠ è½½å™¨ -->
    <div class="loader-wrapper">
      <!-- Logo å’Œæ ‡é¢˜ -->
      <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
        <!-- åŒLogo -->
        <div class="logo-container">
          <!-- Serverpod Logo -->
          <img src="https://serverpod.dev/assets/img/illustration.webp" 
               alt="Serverpod Logo" 
               class="logo-image"
               onerror="this.style.display='none'">

          <!-- Flutter Logo -->
          <img src="assets/icons/Flutter_335_Still_v01.png" 
               alt="Flutter Logo" 
               class="logo-image flutter-logo"
               onerror="this.style.display='none'">
        </div>
        
        <!-- æ ‡é¢˜ -->
        <h1 class="app-title">Serverpod + Flutter Web Admin</h1>
      </div>
      
      <!-- 3Dæ—‹è½¬ç¯ -->
      <div class="rings-container">
        <div class="ring ring-1"></div>
        <div class="ring ring-2"></div>
        <div class="ring ring-3"></div>
        <div class="core"></div>
      </div>
      
      <!-- è¿›åº¦æ¡ -->
      <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-info">
          <span class="progress-percent" id="progress-percent">0%</span>
          <span class="loading-stats" id="loading-stats">åˆå§‹åŒ–ä¸­...</span>
        </div>
      </div>
      
      <!-- åŠ è½½æ–‡æœ¬ -->
      <div style="text-align: center;">
        <div class="loading-text">æ­£åœ¨åŠ è½½ä¸­...</div>
        <div class="loading-subtext">ç²¾å½©å³å°†å‘ˆç°</div>
      </div>
    </div>
  </div>

  <!-- ç²’å­åŠ¨ç”»è„šæœ¬ -->
  <script>
    (function() {
      const canvas = document.getElementById('particles-canvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const particles = [];
      const particleCount = 80;
      
      class Particle {
        constructor() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * canvas.height;
          this.size = Math.random() * 2 + 0.5;
          this.speedX = Math.random() * 0.5 - 0.25;
          this.speedY = Math.random() * 0.5 - 0.25;
          this.opacity = Math.random() * 0.5 + 0.2;
          this.color = ['#6366f1', '#8b5cf6', '#ec4899'][Math.floor(Math.random() * 3)];
        }
        
        update() {
          this.x += this.speedX;
          this.y += this.speedY;
          
          if (this.x > canvas.width) this.x = 0;
          if (this.x < 0) this.x = canvas.width;
          if (this.y > canvas.height) this.y = 0;
          if (this.y < 0) this.y = canvas.height;
        }
        
        draw() {
          ctx.fillStyle = this.color;
          ctx.globalAlpha = this.opacity;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      
      function init() {
        for (let i = 0; i < particleCount; i++) {
          particles.push(new Particle());
        }
      }
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
        
        particles.forEach(particle => {
          particle.update();
          particle.draw();
        });
        
        // ç»˜åˆ¶è¿çº¿
        ctx.globalAlpha = 0.15;
        for (let i = 0; i < particles.length; i++) {
          for (let j = i + 1; j < particles.length; j++) {
            const dx = particles[i].x - particles[j].x;
            const dy = particles[i].y - particles[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < 120) {
              ctx.strokeStyle = '#6366f1';
              ctx.lineWidth = 0.5;
              ctx.beginPath();
              ctx.moveTo(particles[i].x, particles[i].y);
              ctx.lineTo(particles[j].x, particles[j].y);
              ctx.stroke();
            }
          }
        }
        
        requestAnimationFrame(animate);
      }
      
      init();
      animate();
      
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    })();
  </script>

  <!-- åŠ è½½è¿›åº¦ç›‘æ§è„šæœ¬ -->
  <script>
    (function() {
      const progressBar = document.getElementById('progress-bar');
      const progressPercent = document.getElementById('progress-percent');
      const loadingStats = document.getElementById('loading-stats');
      
      let currentProgress = 0;
      let targetProgress = 0;
      let totalResources = 0;
      let loadedResources = 0;
      let totalSize = 0;
      let loadedSize = 0;
      const startTime = Date.now();
      
      // è¿›åº¦æ›´æ–°é˜Ÿåˆ—ç®¡ç†
      let lastStatusChangeTime = Date.now();
      let pendingUpdate = null;
      let isUpdating = false;
      const MIN_STATUS_DURATION = 300; // æ¯ä¸ªçŠ¶æ€æœ€å°‘æ˜¾ç¤º600msï¼Œç¡®ä¿å¯è¯»
      
      // è®°å½•æ‰€æœ‰æ˜¾ç¤ºè¿‡çš„çŠ¶æ€
      let displayedStatuses = [];
      let allUpdateRequests = [];
      
      // æ›´æ–°è¿›åº¦æ¡çš„å‡½æ•°ï¼ˆå¸¦æœ€å°æ˜¾ç¤ºæ—¶é•¿æ§åˆ¶ï¼‰
      function updateProgress(progress, status) {
        const now = Date.now();
        const timeSinceLastChange = now - lastStatusChangeTime;
        const elapsed = ((now - startTime) / 1000).toFixed(2);
        
        // è®°å½•æ‰€æœ‰æ›´æ–°è¯·æ±‚
        allUpdateRequests.push({ time: elapsed, progress, status });
        
        console.log(`[${elapsed}s] ğŸ“¥ æ”¶åˆ°æ›´æ–°è¯·æ±‚ #${allUpdateRequests.length}: ${progress}% - "${status}"`);
        
        // å¦‚æœæœ‰çŠ¶æ€æ–‡å­—å˜åŒ–
        if (status && status !== loadingStats.textContent) {
          console.log(`[${elapsed}s] ğŸ” çŠ¶æ€å˜åŒ–æ£€æµ‹: å½“å‰="${loadingStats.textContent}" â†’ æ–°="${status}"`);
          console.log(`[${elapsed}s] â±ï¸  è·ç¦»ä¸Šæ¬¡æ›´æ–°: ${timeSinceLastChange}ms (æœ€å°é—´éš”: ${MIN_STATUS_DURATION}ms)`);
          
          // å¦‚æœè·ç¦»ä¸Šæ¬¡çŠ¶æ€å˜åŒ–æ—¶é—´å¤ªçŸ­ï¼Œå»¶è¿Ÿæ›´æ–°
          if (timeSinceLastChange < MIN_STATUS_DURATION && !isUpdating) {
            // ä¿å­˜å¾…æ›´æ–°çš„å†…å®¹
            const delay = MIN_STATUS_DURATION - timeSinceLastChange;
            console.log(`[${elapsed}s] â¸ï¸  å»¶è¿Ÿæ›´æ–° ${delay}ms: ${progress}% - "${status}"`);
            
            // å¦‚æœæœ‰å¾…å¤„ç†çš„æ›´æ–°ï¼Œå…ˆå–æ¶ˆ
            if (pendingUpdate) {
              console.log(`[${elapsed}s] âŒ å–æ¶ˆä¹‹å‰çš„å¾…æ›´æ–°: ${pendingUpdate.progress}% - "${pendingUpdate.status}"`);
            }
            
            pendingUpdate = { progress, status };
            
            // è®¾ç½®å»¶è¿Ÿæ›´æ–°
            setTimeout(() => {
              if (pendingUpdate) {
                const delayedElapsed = ((Date.now() - startTime) / 1000).toFixed(2);
                console.log(`[${delayedElapsed}s] â© æ‰§è¡Œå»¶è¿Ÿçš„æ›´æ–°: ${pendingUpdate.progress}% - "${pendingUpdate.status}"`);
                executeUpdate(pendingUpdate.progress, pendingUpdate.status);
                pendingUpdate = null;
              }
            }, delay);
            return;
          }
        }
        
        // ç«‹å³æ‰§è¡Œæ›´æ–°
        console.log(`[${elapsed}s] âœ… ç«‹å³æ‰§è¡Œæ›´æ–°: ${progress}% - "${status}"`);
        executeUpdate(progress, status);
      }
      
      // æ‰§è¡Œå®é™…çš„æ›´æ–°
      function executeUpdate(progress, status) {
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        console.log(`[${elapsed}s] ğŸ¬ å¼€å§‹æ‰§è¡Œæ›´æ–°...`);
        
        isUpdating = true;
        targetProgress = Math.min(progress, 95); // æœ€å¤šåˆ°95%ï¼Œç­‰å¾…FlutterçœŸæ­£åŠ è½½å®Œæˆ
        
        // å¹³æ»‘è¿‡æ¸¡åˆ°ç›®æ ‡è¿›åº¦
        const smoothUpdate = () => {
          if (currentProgress < targetProgress) {
            currentProgress += (targetProgress - currentProgress) * 0.15;
            if (Math.abs(targetProgress - currentProgress) < 0.5) {
              currentProgress = targetProgress;
            }
            progressBar.style.width = currentProgress + '%';
            progressPercent.textContent = Math.floor(currentProgress) + '%';
            if (currentProgress < targetProgress) {
              requestAnimationFrame(smoothUpdate);
            }
          }
        };
        smoothUpdate();
        
        if (status && status !== loadingStats.textContent) {
          const updateElapsed = ((Date.now() - startTime) / 1000).toFixed(2);
          console.log(`[${updateElapsed}s] ğŸ¨ æ›´æ–°çŠ¶æ€æ–‡å­—: "${loadingStats.textContent}" â†’ "${status}"`);
          
          // ç›´æ¥æ›´æ–°æ–‡å­—ï¼Œæ— åŠ¨ç”»
          loadingStats.textContent = status;
          lastStatusChangeTime = Date.now();
          
          // è®°å½•å®é™…æ˜¾ç¤ºçš„çŠ¶æ€
          displayedStatuses.push({ 
            time: updateElapsed, 
            progress: Math.floor(currentProgress), 
            status 
          });
          
          console.log(`[${updateElapsed}s] âœ¨ çŠ¶æ€å·²æ˜¾ç¤º #${displayedStatuses.length}: ${Math.floor(currentProgress)}% - "${status}"`);
          console.log(`[${updateElapsed}s] â° æ­¤çŠ¶æ€å°†æ˜¾ç¤ºè‡³å°‘ ${MIN_STATUS_DURATION}ms\n`);
        }
        
        isUpdating = false;
      }
      
      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatBytes(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
      }
      
      // ============================================
      // çœŸå®è¿›åº¦ç›‘æ§: èµ„æºåŠ è½½ (å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œ)
      // ä½¿ç”¨ PerformanceObserver å®æ—¶ç›‘å¬ç½‘ç»œè¯·æ±‚
      // é™åˆ¶åœ¨30%-60%åŒºé—´ï¼Œé¿å…è·³è·ƒå¤ªå¿«
      // ============================================
      if (window.performance && window.PerformanceObserver) {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (entry.initiatorType === 'script' || entry.initiatorType === 'fetch') {
              totalResources++;
              
              // ä¼°ç®—å·²åŠ è½½çš„èµ„æº
              if (entry.responseEnd > 0) {
                loadedResources++;
                
                // å¦‚æœæœ‰transferSizeä¿¡æ¯ï¼Œç´¯åŠ å¤§å°
                if (entry.transferSize) {
                  loadedSize += entry.transferSize;
                  totalSize += entry.transferSize;
                }
                
                // è®¡ç®—è¿›åº¦ - èµ„æºåŠ è½½åªå 30%-60%çš„åŒºé—´ï¼ˆç¼©å°èŒƒå›´ï¼Œé¿å…è·³å¤ªå¿«ï¼‰
                const resourceRatio = loadedResources / Math.max(totalResources, 1);
                const resourceProgress = 30 + (resourceRatio * 30); // ä»30%åˆ°60%
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                
                let status = `åŠ è½½èµ„æºä¸­ (${loadedResources}/${totalResources})`;
                if (loadedSize > 0) {
                  status = `å·²åŠ è½½ ${formatBytes(loadedSize)} â€¢ ${elapsed}s`;
                }
                
                // åªæœ‰å½“æ–°è¿›åº¦å¤§äºå½“å‰è¿›åº¦æ—¶æ‰æ›´æ–°ï¼Œä¸”ä¸è¶…è¿‡60%
                if (resourceProgress > currentProgress && resourceProgress <= 60) {
                  updateProgress(resourceProgress, status);
                }
              }
            }
          }
        });
        
        observer.observe({ entryTypes: ['resource'] });
      }
      
      // ============================================
      // å¹¶è¡Œæœºåˆ¶1: ä¿åº•å®šæ—¶å™¨ï¼ˆé˜²æ­¢è¿›åº¦å¡ä½ï¼‰
      // åªæœ‰å½“å®é™…è¿›åº¦ä½äºç›®æ ‡æ—¶æ‰ä¼šæ›´æ–°
      // ============================================
      let hasStartedLoading = false;
      
      // é˜¶æ®µ1: åˆå§‹åŒ–ï¼ˆ0-10%ï¼‰
      setTimeout(() => {
        if (currentProgress < 10) {
          updateProgress(10, 'æ­£åœ¨åˆå§‹åŒ–...');
        }
      }, 200);
      
      // é˜¶æ®µ2: åŠ è½½å¼•æ“ï¼ˆ10-20%ï¼‰
      setTimeout(() => {
        if (currentProgress < 20) {
          updateProgress(20, 'åŠ è½½å¼•æ“ä¸­...');
        }
      }, 500);
      
      // é˜¶æ®µ3: åŠ è½½æ ¸å¿ƒæ¨¡å—ï¼ˆ20-30%ï¼‰
      setTimeout(() => {
        if (currentProgress < 30) {
          updateProgress(30, 'åŠ è½½æ ¸å¿ƒæ¨¡å—...');
        }
      }, 900);
      
      // èµ„æºåŠ è½½ä¼šåœ¨30%-60%åŒºé—´å®æ—¶æ›´æ–°ï¼ˆPerformanceObserverï¼‰
      
      // é˜¶æ®µ4: å‡†å¤‡æ¸²æŸ“ï¼ˆ60-65%ï¼‰
      setTimeout(() => {
        if (currentProgress < 65) {
          updateProgress(65, 'å‡†å¤‡æ¸²æŸ“...');
        }
      }, 2000);
      
      // é˜¶æ®µ5: åˆå§‹åŒ–æ¡†æ¶ï¼ˆ65-75%ï¼‰
      setTimeout(() => {
        if (currentProgress < 75) {
          updateProgress(75, 'åˆå§‹åŒ–æ¡†æ¶...');
        }
      }, 2500);
      
      // é˜¶æ®µ6: æ¸²æŸ“ç•Œé¢ï¼ˆ75-85%ï¼‰
      setTimeout(() => {
        if (currentProgress < 85) {
          updateProgress(85, 'æ¸²æŸ“ç•Œé¢...');
        }
      }, 3000);
      
      // é˜¶æ®µ7: å³å°†å®Œæˆï¼ˆ85-90%ï¼‰
      setTimeout(() => {
        if (currentProgress < 90) {
          updateProgress(90, 'å³å°†å®Œæˆ...');
        }
      }, 3500);
      
      // ============================================
      // å¹¶è¡Œæœºåˆ¶3: å­—ä½“åŠ è½½ç›‘æ§ï¼ˆç‹¬ç«‹è½®è¯¢ï¼‰
      // æ¯100msæ£€æŸ¥ä¸€æ¬¡ï¼Œä¸å…¶ä»–åŠ è½½è¿‡ç¨‹å¹¶è¡Œ
      // ============================================
      let fontsLoaded = false;
      let flutterReady = false;
      
      function checkAndHideLoader() {
        // åªæœ‰å½“ Flutter å°±ç»ªä¸”å­—ä½“åŠ è½½å®Œæˆæ—¶æ‰éšè—åŠ è½½å™¨
        // è¿™æ˜¯ä¸€ä¸ª"ä¸"å…³ç³»ï¼Œä¸¤ä¸ªæ¡ä»¶å¿…é¡»éƒ½æ»¡è¶³
        if (flutterReady && fontsLoaded) {
          updateProgress(100, 'åŠ è½½å®Œæˆï¼');
          progressPercent.textContent = '100%';
          
          // æ‰“å°æ€»ç»“æŠ¥å‘Š
          setTimeout(() => {
            console.log('\n' + '='.repeat(80));
            console.log('ğŸ“Š åŠ è½½è¿›åº¦ç»Ÿè®¡æŠ¥å‘Š');
            console.log('='.repeat(80));
            console.log(`â±ï¸  æ€»åŠ è½½æ—¶é—´: ${((Date.now() - startTime) / 1000).toFixed(2)}ç§’`);
            console.log(`ğŸ“¨ æ€»æ›´æ–°è¯·æ±‚æ•°: ${allUpdateRequests.length}`);
            console.log(`âœ… å®é™…æ˜¾ç¤ºçŠ¶æ€æ•°: ${displayedStatuses.length}`);
            console.log(`âŒ è¢«è·³è¿‡/å»¶è¿Ÿè¦†ç›–: ${allUpdateRequests.length - displayedStatuses.length}`);
            console.log('');
            
            console.log('ğŸ“‹ æ‰€æœ‰æ›´æ–°è¯·æ±‚åˆ—è¡¨:');
            allUpdateRequests.forEach((req, index) => {
              console.log(`  ${index + 1}. [${req.time}s] ${req.progress}% - "${req.status}"`);
            });
            console.log('');
            
            console.log('âœ¨ å®é™…æ˜¾ç¤ºçš„çŠ¶æ€:');
            displayedStatuses.forEach((status, index) => {
              console.log(`  ${index + 1}. [${status.time}s] ${status.progress}% - "${status.status}"`);
            });
            console.log('');
            
            console.log('ğŸš« æœªæ˜¾ç¤ºçš„æ›´æ–°è¯·æ±‚:');
            const displayedTexts = displayedStatuses.map(s => s.status);
            const missedRequests = allUpdateRequests.filter(req => !displayedTexts.includes(req.status));
            if (missedRequests.length > 0) {
              missedRequests.forEach((req, index) => {
                console.log(`  ${index + 1}. [${req.time}s] ${req.progress}% - "${req.status}" âš ï¸ è¢«è·³è¿‡`);
              });
            } else {
              console.log('  æ—  - æ‰€æœ‰è¯·æ±‚éƒ½è¢«æ˜¾ç¤ºäº†ï¼ âœ…');
            }
            
            console.log('='.repeat(80) + '\n');
          }, 100);
          
          setTimeout(() => {
            const loadingContainer = document.getElementById('loading-container');
            loadingContainer.classList.add('fade-out');
            setTimeout(() => {
              loadingContainer.style.display = 'none';
            }, 800);
          }, 300);
        }
      }
      
      // å­—ä½“åŠ è½½ç›‘æ§ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
      if (document.fonts && document.fonts.ready) {
        let fontLoadStartTime = 0;
        let fontLoadingStarted = false;
        
        // ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼ï¼šç›‘å¬ document.fonts çš„ size å˜åŒ–
        const initialFontCount = document.fonts.size;
        let lastFontCount = initialFontCount;
        
        // å®šæœŸæ£€æŸ¥å­—ä½“åŠ è½½çŠ¶æ€
        const fontCheckInterval = setInterval(() => {
          const currentFontCount = document.fonts.size;
          
          // æ£€æµ‹åˆ°å­—ä½“å¼€å§‹åŠ è½½
          if (currentFontCount > lastFontCount && !fontLoadingStarted) {
            fontLoadingStarted = true;
            fontLoadStartTime = Date.now();
          }
          
          if (fontLoadingStarted) {
            const elapsed = ((Date.now() - fontLoadStartTime) / 1000).toFixed(1);
            const loadedCount = currentFontCount - initialFontCount;
            
            // æ¨¡æ‹Ÿæ¸è¿›å¼åŠ è½½ï¼ˆåŸºäºæ—¶é—´ï¼‰
            if (currentProgress >= 90 && currentProgress < 95) {
              if (elapsed < 0.5) {
                updateProgress(91, `åŠ è½½å­—ä½“ä¸­...`);
              } else if (elapsed < 1.0) {
                updateProgress(93, `åŠ è½½å­—ä½“ä¸­...`);
              } else {
                updateProgress(94, `åŠ è½½å­—ä½“ä¸­...`);
              }
            }
          }
          
          lastFontCount = currentFontCount;
        }, 100);
        
        // ç­‰å¾…æ‰€æœ‰å­—ä½“åŠ è½½å®Œæˆ
        document.fonts.ready.then(() => {
          clearInterval(fontCheckInterval);
          console.log('All fonts loaded successfully');
          fontsLoaded = true;
          updateProgress(95, 'åŠ è½½å®Œæˆï¼');
          checkAndHideLoader();
        });
        
        // è¶…æ—¶ä¿æŠ¤ï¼šæœ€å¤šç­‰å¾…5ç§’å­—ä½“åŠ è½½
        setTimeout(() => {
          clearInterval(fontCheckInterval);
          if (!fontsLoaded) {
            console.warn('Font loading timeout, proceeding anyway');
            fontsLoaded = true;
            checkAndHideLoader();
          }
        }, 5000);
      } else {
        // æµè§ˆå™¨ä¸æ”¯æŒ Font Loading APIï¼Œç›´æ¥æ ‡è®°ä¸ºå®Œæˆ
        console.log('Font Loading API not supported');
        fontsLoaded = true;
      }
      
      // ============================================
      // å¹¶è¡Œæœºåˆ¶4: Flutter å°±ç»ªäº‹ä»¶ï¼ˆå¼‚æ­¥å›è°ƒï¼‰
      // ç”± Flutter å¼•æ“åœ¨é¦–å¸§æ¸²æŸ“å®Œæˆåè§¦å‘
      // ä¸å…¶ä»–æ‰€æœ‰æœºåˆ¶å®Œå…¨å¹¶è¡Œæ‰§è¡Œ
      // ============================================
      window.addEventListener('flutter-first-frame', function() {
        console.log('Flutter first frame rendered');
        flutterReady = true;
        // Flutter æ¸²æŸ“å®Œæˆåï¼Œè®©å­—ä½“åŠ è½½æ¥ç®¡è¿›åº¦æ˜¾ç¤º
        // ä¸åœ¨è¿™é‡Œæ›´æ–°è¿›åº¦ï¼Œç”±å­—ä½“åŠ è½½ç›‘æ§æ¥æ˜¾ç¤º
        checkAndHideLoader(); // å°è¯•éšè—ï¼ˆéœ€è¦åŒæ—¶æ»¡è¶³ fontsLoadedï¼‰
      });
      
      // è¶…æ—¶ä¿æŠ¤ï¼šå¦‚æœ30ç§’è¿˜æ²¡åŠ è½½å®Œæˆï¼Œå¼ºåˆ¶æ˜¾ç¤ºé«˜è¿›åº¦
      setTimeout(() => {
        if (currentProgress < 90) {
          updateProgress(90, 'æ­£åœ¨å®Œæˆæœ€åæ­¥éª¤...');
        }
      }, 30000);
      
    })();
  </script>

  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
