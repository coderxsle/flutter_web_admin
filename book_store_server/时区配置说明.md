# Docker Compose 时区配置详细说明

## 配置层次对比

### 1. 最简配置（推荐新手使用）

```yaml
environment:
  TZ: Asia/Shanghai      # 设置容器时区
  PGTZ: Asia/Shanghai    # 设置PostgreSQL时区
```

**优点：**
- 配置简单，容易理解
- 满足基本需求
- 不需要额外文件

**缺点：**
- 时区设置可能不够持久
- 无法进行高级配置

### 2. 标准配置（推荐生产使用）

```yaml
environment:
  TZ: Asia/Shanghai
  PGTZ: Asia/Shanghai
volumes:
  - ./init-timezone.sql:/docker-entrypoint-initdb.d/01-init-timezone.sql
command: >
  postgres
  -c timezone=Asia/Shanghai
  -c log_timezone=Asia/Shanghai
```

**优点：**
- 时区设置更可靠
- 包含日志时区设置
- 有初始化脚本保证

**缺点：**
- 需要额外的SQL文件
- 配置稍微复杂

### 3. 完整配置（高级用户）

```yaml
environment:
  TZ: Asia/Shanghai
  PGTZ: Asia/Shanghai
volumes:
  - ./init-timezone.sql:/docker-entrypoint-initdb.d/01-init-timezone.sql
  - ./postgresql.conf:/etc/postgresql/postgresql.conf:ro
command: >
  postgres
  -c config_file=/etc/postgresql/postgresql.conf
  -c timezone=Asia/Shanghai
  -c log_timezone=Asia/Shanghai
```

**优点：**
- 完全控制PostgreSQL配置
- 可以设置更多参数
- 配置最稳定

**缺点：**
- 配置最复杂
- 需要多个配置文件
- 维护成本高

## 各配置项详细说明

### 环境变量

| 变量名 | 作用 | 是否必须 |
|--------|------|----------|
| `TZ` | 设置容器系统时区 | 必须 |
| `PGTZ` | 设置PostgreSQL时区 | 推荐 |
| `POSTGRES_INITDB_ARGS` | 初始化参数 | 可选 |

### 卷挂载

| 挂载项 | 作用 | 是否必须 |
|--------|------|----------|
| `init-timezone.sql` | 初始化时区脚本 | 推荐 |
| `postgresql.conf` | PostgreSQL配置文件 | 可选 |

### 命令参数

| 参数 | 作用 | 是否必须 |
|------|------|----------|
| `-c timezone=Asia/Shanghai` | 运行时设置时区 | 推荐 |
| `-c log_timezone=Asia/Shanghai` | 设置日志时区 | 推荐 |
| `-c config_file=...` | 使用自定义配置 | 可选 |

## 推荐配置方案

### 开发环境
使用最简配置：
```yaml
environment:
  TZ: Asia/Shanghai
  PGTZ: Asia/Shanghai
```

### 生产环境
使用标准配置：
```yaml
environment:
  TZ: Asia/Shanghai
  PGTZ: Asia/Shanghai
volumes:
  - ./init-timezone.sql:/docker-entrypoint-initdb.d/01-init-timezone.sql
command: >
  postgres
  -c timezone=Asia/Shanghai
  -c log_timezone=Asia/Shanghai
```

## 验证时区设置

启动容器后，可以通过以下命令验证时区设置：

```bash
# 进入PostgreSQL容器
docker exec -it book_store_postgres bash

# 检查系统时区
date

# 检查PostgreSQL时区
psql -U postgres -d book_store -c "SHOW timezone;"

# 检查当前时间
psql -U postgres -d book_store -c "SELECT now();"
```




